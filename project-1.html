<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Progetto 1 — Francesca Mirabile</title>
  <style>
    @font-face {
      font-family: "Helvetica Now Display";
      src: url("./Font/HelveticaNowDisplay-Bold.woff") format("woff");
      font-weight: 700;
      font-style: normal;
      font-display: swap;
    }

    :root {
      --bg: #ffffff;
      --text: #0b0b0b;
      --line: #cfcfcf;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
      font-family: "Helvetica Now Display", Helvetica, Arial, sans-serif;
      font-size: 12px;
      line-height: 1.05;
      overflow: hidden;
    }

    a {
      color: inherit;
      text-decoration: none;
    }

    header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      display: grid;
      grid-template-columns: 1fr 1fr;
      font-size: 12px;
      padding: 3px;
      z-index: 3;
    }

    .left-nav {
      display: flex;
      gap: 32px;
      align-items: center;
    }

    .right-nav {
      display: flex;
      gap: 32px;
      justify-content: flex-end;
      align-items: center;
    }

    .split {
      position: fixed;
      inset: 0;
      display: grid;
      grid-template-columns: 1fr 1fr;
    }

    .split::before {
      content: "";
      position: absolute;
      left: 50%;
      top: 0;
      width: 1px;
      height: 100%;
      background: var(--line);
      z-index: 2;
    }

    .column {
      padding: 40px 20px 30px;
      height: 100vh;
      overflow-y: auto;
    }

    .cover {
      width: 100%;
      height: auto;
      display: block;
      margin-top: 30px;
    }

    .info-block {
      margin-top: 40px;
      display: grid;
      row-gap: 14px;
      font-size: 12px;
    }

    .info-top {
      display: grid;
      grid-template-columns: auto 1fr auto;
      align-items: start;
      column-gap: 12px;
    }

    .info-top span {
      text-align: left;
    }

    .info-text {
      line-height: 1.05;
    }

    .credits {
      display: grid;
      grid-template-columns: auto 1fr;
      column-gap: 12px;
      row-gap: 6px;
      max-width: 360px;
      line-height: 1.0;
    }

    .gallery {
      margin-top: 60px;
      display: grid;
      grid-template-columns: repeat(3, minmax(200px, 1fr));
      column-gap: 32px;
      row-gap: 48px;
      align-content: start;
    }

    .gallery .item {
      display: grid;
      row-gap: 6px;
      width: 100%;
      margin: 0;
    }

    .gallery img {
      width: 100%;
      height: auto;
      display: block;
    }

    .gallery .meta {
      display: grid;
      grid-template-columns: auto;
      row-gap: 2px;
      align-items: baseline;
      line-height: 1.05;
    }

    @media (max-width: 960px) {
      body {
        height: auto;
        overflow-y: auto;
      }
      .split {
        position: static;
        grid-template-columns: 1fr;
      }
      .split::before {
        display: none;
      }
      .column {
        height: auto;
        overflow: visible;
        padding: 60px 16px 32px;
      }
      .column + .column {
        border-top: 1px solid var(--line);
      }
      .gallery {
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      }
      .cover {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="left-nav">
      <div><a href="Index.html">Francesca Mirabile</a></div>
    </div>
    <div class="right-nav">
      <div><a href="About.html">About</a></div>
      <div><a href="mailto:info@francescamirabile">Contact</a></div>
      <div><a href="Archive.html">Archive</a></div>
    </div>
  </header>

  <div class="split">
    <div class="column">
      <img class="cover" src="./img/Screenshot 2025-12-09 alle 16.45.48.png" alt="Cover progetto">
    </div>

    <div class="column">
      <div class="info-block">
        <div class="info-top">
          <span id="project-number">1</span>
          <span id="project-title" style="text-align:center;">Titolo Opera, 2025</span>
          <span id="project-technique">Collage + sipario: carta<br>Struttura: ferro e alluminio</span>
        </div>
        <div class="info-text" id="project-description">
          Francesca Mirabile, Collage + sipario: carta Struttura: ferro e alluminio. Rori sapictes mi, omnimod quam vendipsam, explignisque maximil imillabo. Fugiame pe doluptatus et que peritisit, cum nihiti ut et autaspe rferunt empore vit, utaepel eum quia in conem sit untiora simentor ad ut est aut aut inullignist qui ate cus, net eiur autemque poraecab iminihil imodist, que doluptatur, cum que dis ipsanda acil idunt. Unt voluptatem voluptas res ad et a num dolorit quis as et ea vendi nistia inctios unt arit omni rem vellectem ent as essumquid qui omnit, consequam, corepe conseque evel modi beris moluteces iur? Ribus doluptis sumquatem. Nam ea sed maximi, verionsed mo ipsam con eos et fugitaepro illecum facculloreri cullab ipsam quam res sit.
        </div>
        <div class="credits" id="project-credits">
          <span>Crediti</span><span>Foto: Andrea Benedetta B</span>
          <span></span><span>Grafiche: ATIO Studio</span>
        </div>
      </div>

      <div class="gallery" id="gallery"></div>
    </div>
  </div>
  <script src="./Asset/sanity-config.js"></script>
  <script src="./Asset/sanity-client.js"></script>
  <script>
    const gallery = document.getElementById('gallery');
    const coverImg = document.querySelector('.cover');
    const numberEl = document.getElementById('project-number');
    const titleEl = document.getElementById('project-title');
    const techniqueEl = document.getElementById('project-technique');
    const descEl = document.getElementById('project-description');
    const creditsEl = document.getElementById('project-credits');
    const params = new URLSearchParams(window.location.search);
    const slug = params.get('slug');

    const fallbackGallery = [
      {title: '1', img: './img/Screenshot 2025-12-09 alle 16.46.32.png'},
      {title: '2', img: './img/Screenshot 2025-12-09 alle 16.46.42.png'},
      {title: '3', img: './img/Screenshot 2025-12-09 alle 16.46.45.png'},
      {title: '4', img: './img/Screenshot 2025-12-09 alle 16.45.48.png'},
      {title: '5', img: './img/Screenshot 2025-12-09 alle 16.46.13.png'},
      {title: '6', img: './img/Screenshot 2025-12-09 alle 16.46.36.png'},
    ];
    const fallbackDescription =
      'Francesca Mirabile, Collage + sipario: carta Struttura: ferro e alluminio. Rori sapictes mi, omnimod quam vendipsam, explignisque maximil imillabo. Fugiame pe doluptatus et que peritisit, cum nihiti ut et autaspe rferunt empore vit, utaepel eum quia in conem sit untiora simentor ad ut est aut aut inullignist qui ate cus, net eiur autemque poraecab iminihil imodist, que doluptatur, cum que dis ipsanda acil idunt. Unt voluptatem voluptas res ad et a num dolorit quis as et ea vendi nistia inctios unt arit omni rem vellectem ent as essumquid qui omnit, consequam, corepe conseque evel modi beris moluteces iur? Ribus doluptis sumquatem. Nam ea sed maximi, verionsed mo ipsam con eos et fugitaepro illecum facculloreri cullab ipsam quam res sit.';
    const fallbackCredits = ['Foto: Andrea Benedetta B', 'Grafiche: ATIO Studio'];

    const shuffle = (arr) => {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    };

    const assignSpans = () => {
      let remaining = 3;
      Array.from(gallery.children).forEach((item) => {
        const span = Math.max(1, Math.min(remaining, Math.floor(Math.random() * 3) + 1));
        item.style.gridColumn = `span ${span}`;
        remaining -= span;
        if (remaining <= 0) remaining = 3;
      });
    };

    const renderGallery = (items) => {
      const shuffled = shuffle([...items]);
      gallery.innerHTML = '';
      shuffled.forEach((item) => {
        const node = document.createElement('div');
        node.className = 'item';
        const meta = document.createElement('div');
        meta.className = 'meta';
        const title = document.createElement('span');
        title.className = 'title';
        title.textContent = item.title || '';
        meta.appendChild(title);
        const img = document.createElement('img');
        img.src = item.img;
        img.alt = item.title || 'Vista';
        node.appendChild(meta);
        node.appendChild(img);
        gallery.appendChild(node);
      });
      assignSpans();
    };

    const renderCredits = (lines) => {
      creditsEl.innerHTML = '';
      lines.forEach((line, idx) => {
        const label = idx === 0 ? 'Crediti' : '';
        const labelEl = document.createElement('span');
        labelEl.textContent = label;
        const valEl = document.createElement('span');
        valEl.textContent = line;
        creditsEl.appendChild(labelEl);
        creditsEl.appendChild(valEl);
      });
    };

    async function loadFromSanity() {
      if (!slug) {
        descEl.innerHTML = 'Nessun progetto selezionato.';
        renderCredits(fallbackCredits);
        renderGallery(fallbackGallery);
        return;
      }
      try {
        const [settings, project] = await Promise.all([
          window.SanityClient.fetch('*[_id == "siteSettings"][0]{contactEmail}'),
          window.SanityClient.fetch(
            '*[_type == "project" && slug.current == $slug][0]{order, title, slug, dimensions, technique, description, credits, "cover": coalesce(cover.asset->url, cover.asset->_ref), gallery[]{asset->{url,_ref}}}',
            {slug}
          ),
        ]);

        if (settings?.contactEmail) {
          document.querySelectorAll('a[href^="mailto:info"]').forEach((a) => {
            a.href = `mailto:${settings.contactEmail}`;
          });
        }

        if (project) {
          numberEl.textContent = project.order || '';
          titleEl.textContent = project.title || project.slug?.current || '';
          const techText = [project.dimensions, project.technique].filter(Boolean).join(' · ');
          techniqueEl.textContent = techText || techniqueEl.textContent;
          if (project.cover) {
            coverImg.src = project.cover.startsWith('http')
              ? project.cover
              : window.SanityClient.imageUrlFromRef(project.cover);
          }
          if (project.description) {
            const html = window.SanityClient.portableTextToHtml(project.description);
            if (html) descEl.innerHTML = html;
          }
          if (project.credits && project.credits.length) {
            const lines = project.credits
              .map((block) =>
                block?.children ? block.children.map((c) => c.text || '').join('') : ''
              )
              .filter(Boolean);
            if (lines.length) renderCredits(lines);
          }
          const galleryItems =
            (project.gallery || [])
              .map((g, idx) => ({
                title: String(idx + 1),
                img: g.asset?.url || window.SanityClient.imageUrlFromRef(g.asset?._ref),
              }))
              .filter((g) => g.img) || [];
          if (galleryItems.length) {
            renderGallery(galleryItems);
            return;
          }
        }
      } catch (err) {
        console.warn('Sanity non disponibile, uso dati statici del progetto:', err.message);
      }
      descEl.innerHTML = fallbackDescription;
      renderCredits(fallbackCredits);
      renderGallery(fallbackGallery);
    }

    loadFromSanity();
  </script>
</body>
</html>
